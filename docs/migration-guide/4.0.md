# 4.0 Migration Guide

In this document we describe the steps that should be taken to migrate from `orchestrator-core` v3 to v4.

## About 4.0

In this release, the [workflow target validate](../architecture/application/workflow.md#validate) `SYSTEM` has been
removed for validate workflows and a new target `VALIDATE` has been added. The `SYSTEM` target was used to target
validation workflows, thus some workflows were expected to be run in the context of a system. This was not the case for
all validation workflows, so we have added a new target `VALIDATE` to be used for these workflows. The `SYSTEM` target
is now only used for system workflows.

The change of the `SYSTEM` target to `VALIDATE` is a breaking change, as it will break any workflows that are using the
`SYSTEM` target for validation workflows. You will need to update your workflows to use the `VALIDATE` target instead.

In the Steps section below we describe how to update your workflows to use the new `VALIDATE` target.

## Steps

We assume you have a workflow table that looks like this:

| workflow_id                          | name                       | target | description                                                            | created_at                        | deleted_at |
|--------------------------------------|----------------------------|--------|------------------------------------------------------------------------|-----------------------------------|------------|
| ded79954-f16e-422b-a204-7770a59757e8 | modify_note                | MODIFY | Modify Note                                                            | 2025-05-01 09:57:28.033504 +00:00 | <null>     |
| ca6a76ff-dd4e-4f66-9fb0-cee1878f0d20 | task_clean_up_tasks        | SYSTEM | Clean up old tasks                                                     | 2025-05-01 09:57:28.033504 +00:00 | <null>     |
| 40058c3d-0c95-47f4-a75f-93719299c5be | task_resume_workflows      | SYSTEM | Resume all workflows that are stuck on tasks with the status 'waiting' | 2025-05-01 09:57:28.033504 +00:00 | <null>     |
| 33b5520e-85d4-4ca1-8713-d26f7de5b7a5 | task_validate_products     | SYSTEM | Validate products                                                      | 2025-05-01 09:57:28.033504 +00:00 | <null>     |
| 94d4889e-6bb6-4724-a9d2-f21696fe6f43 | task_validate_product_type | SYSTEM | Validate all subscriptions of Product Type                             | 2025-05-01 09:57:28.033504 +00:00 | <null>     |

The `target` in this table is no longer valid for the `task_validate_products` and `task_validate_product_type`
workflows. You will need to update the `target` to `VALIDATE` for these workflows. You can do this by running the
following

SQL command:

```sql
UPDATE workflow
SET target = 'VALIDATE'
WHERE name IN ('task_validate_products', 'task_validate_product_type');
```

This will update the `target` for the `task_validate_products` and `task_validate_product_type` workflows to `VALIDATE`.

In case you have workflows that start with `validate_`, you can also run the following SQL command to update all

workflows that start with `validate_`:

```sql
UPDATE workflow
SET target = 'VALIDATE'
WHERE name LIKE 'validate_%';
```

This will update the `target` for all workflows that start with `validate_` to `VALIDATE`.
This is a breaking change, so you will need to test your workflows after making this change to ensure that they are
working as expected.
